// Pages API Routes - Returns available pages for permission management
const express = require('express');
const router = express.Router();
const authMiddleware = require('../middleware/auth');

// Define all available pages in the system
const SYSTEM_PAGES = [
  // Dashboard Pages
  { key: 'dashboard', name: 'Main Dashboard', module: 'Dashboard' },
  { key: 'admin', name: 'Admin Dashboard', module: 'Administration' },
  { key: 'manager', name: 'Manager Dashboard', module: 'Administration' },
  { key: 'staff', name: 'Staff Dashboard', module: 'Administration' },
  
  // Finance Pages
  { key: 'cfo-dashboard', name: 'CFO Dashboard', module: 'Finance' },
  { key: 'finance-controller', name: 'Finance Controller', module: 'Finance' },
  { key: 'treasury', name: 'Treasury', module: 'Finance' },
  { key: 'accounts', name: 'Accounts', module: 'Finance' },
  { key: 'accounts-payable', name: 'Accounts Payable', module: 'Finance' },
  { key: 'banker', name: 'Banker', module: 'Finance' },
  { key: 'finance/general-ledger', name: 'General Ledger', module: 'Finance' },
  { key: 'finance/accounts-payable-summary', name: 'Accounts Payable Summary', module: 'Finance' },
  { key: 'finance/accounts-receivable-summary', name: 'Accounts Receivable Summary', module: 'Finance' },
  { key: 'finance/executive-dashboard', name: 'Executive Dashboard', module: 'Finance' },
  
  // Procurement & Operations
  { key: 'procurement-officer', name: 'Procurement Officer', module: 'Procurement' },
  { key: 'procurement/purchase-orders', name: 'Purchase Orders', module: 'Procurement' },
  { key: 'store-incharge', name: 'Store Incharge', module: 'Operations' },
  { key: 'hub-incharge', name: 'Hub Incharge', module: 'Operations' },
  { key: 'operations-manager', name: 'Operations Manager', module: 'Operations' },
  { key: 'operations/inventory-management', name: 'Inventory Management', module: 'Operations' },
  { key: 'operations/kpi-dashboard', name: 'KPI Dashboard', module: 'Operations' },
  
  // Compliance & Legal
  { key: 'compliance-officer', name: 'Compliance Officer', module: 'Compliance' },
  { key: 'legal', name: 'Legal', module: 'Compliance' },
  { key: 'compliance/compliance-dashboard', name: 'Compliance Dashboard', module: 'Compliance' },
  { key: 'compliance/legal-case-management', name: 'Legal Case Management', module: 'Compliance' },
  
  // IT & System
  { key: 'it-admin', name: 'IT Admin', module: 'IT & System' },
  { key: 'system/system-settings', name: 'System Settings', module: 'IT & System' },
  { key: 'system/permission-manager', name: 'Permission Manager', module: 'IT & System' },
  { key: 'system/roles-users-report', name: 'Roles & Users Report', module: 'IT & System' },
  
  // Task Management
  { key: 'task-dashboard', name: 'Task Dashboard', module: 'Tasks' },
];

// GET /api/pages - Return all available pages
router.get('/', authMiddleware.authenticate, async (req, res) => {
  try {
    res.json({
      success: true,
      data: SYSTEM_PAGES,
      count: SYSTEM_PAGES.length,
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('Error fetching pages:', error);
    res.status(500).json({
      success: false,
      error: {
        message: 'Failed to fetch pages',
        code: 'PAGES_ERROR'
      },
      timestamp: new Date().toISOString()
    });
  }
});

module.exports = router;
