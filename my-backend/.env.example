## SMTP / Email (LEGACY - disabled by default)
# SMTP_HOST=mail.my-domain.com
# SMTP_PORT=587
# SMTP_USER=no-reply@my-domain.com
# SMTP_PASS=changeme
# SMTP_SECURE=false
# FROM_EMAIL="No Reply <no-reply@my-domain.com>"
# DKIM_DOMAIN=
# DKIM_SELECTOR=default
# DKIM_PRIVATE_KEY=

# Legacy Mail OTP & Notification (deprecated)
# OTP_LENGTH=6
# OTP_EXPIRE_MIN=5
# OTP_HASH_SECRET=replace_with_long_random_secret
# RATE_LIMIT_IP=20
# RATE_LIMIT_EMAIL=5

# Trial OTP (Redis-backed) configuration
TRIAL_OTP_LENGTH=6
TRIAL_OTP_TTL_SEC=600
TRIAL_OTP_REQ_PER_EMAIL=5
TRIAL_OTP_REQ_PER_IP=20
TRIAL_OTP_RESEND_MAX=3
OTP_HASH_SECRET=replace_with_long_random_secret
ENABLE_LEGACY_MAIL_OTP=0

COMPANY_NAME="My ERP"
COMPANY_DOMAIN="my-domain.com"
SUPPORT_EMAIL="support@my-domain.com"
# Backend Environment Variables
# Copy this file to .env and fill in your actual values

# Server Configuration
PORT=3000
NODE_ENV=development

# Database Configuration
DATABASE_URL=postgres://username:password@localhost:5432/bisman_db
DB_USER=postgres
DB_PASSWORD=your_password_here
DB_HOST=localhost
DB_PORT=5432
DB_NAME=BISMAN

# Frontend CORS Configuration
# For production, add your Vercel deployment URL
FRONTEND_URL=http://localhost:3001
FRONTEND_URLS=http://localhost:3001,http://localhost:3000,https://bisman-erp-building.vercel.app

# Redis Configuration (if used)
REDIS_HOST=127.0.0.1
REDIS_PORT=6379

# Rate Limiting Configuration
# Set to 'true' to disable rate limiting (recommended for local development)
# Set to 'false' or remove for production (rate limiting will be active)
DISABLE_RATE_LIMIT=true

# JWT Secrets (generate strong random strings for production)
JWT_SECRET=your-super-secret-jwt-key-here
ACCESS_TOKEN_SECRET=your-access-token-secret-here
REFRESH_TOKEN_SECRET=your-refresh-token-secret-here

# Optional: Monitoring
SENTRY_DSN=
JAEGER_ENDPOINT=
SERVICE_NAME=bisman-erp-backend

# Optional: Dry Run Mode
DRY_RUN=false

# Calls (Jitsi) Integration
JITSI_DOMAIN=jitsi.internal.example
JITSI_PUBLIC_URL=https://jitsi.internal.example
JITSI_APP_ID=erp-calls
JITSI_JWT_SECRET=replace_with_strong_secret

# TURN (coturn)
TURN_HOST=turn.internal.example
TURN_PORT=3478
TURN_TRANSPORT=udp

# ============================================================================
# PgBouncer Connection Pooling (Production)
# ============================================================================
# When using PgBouncer, update DATABASE_URL to point to PgBouncer instead of Postgres directly.
# The ?pgbouncer=true flag is required for Prisma compatibility in transaction pool mode.
#
# Direct connection (development):
# DATABASE_URL="postgresql://bisman_app:password@localhost:5432/bisman_prod"
#
# Via PgBouncer (production):
# DATABASE_URL="postgresql://bisman_app:password@pgbouncer:6432/bisman_prod?pgbouncer=true&sslmode=require"
#
# Connection pool settings (Prisma will use these):
# - connection_limit: Should match PgBouncer's default_pool_size
# - pool_timeout: How long to wait for a connection
#
# Example with Prisma options:
# DATABASE_URL="postgresql://user:pass@pgbouncer:6432/db?pgbouncer=true&connection_limit=20&pool_timeout=10"

# ============================================================================
# Read Replicas (Production)
# ============================================================================
# Configure read replicas to offload read-heavy queries from primary.
# The query router automatically routes:
#   - GET requests → replica
#   - POST/PUT/DELETE → primary
#
# Primary database (read/write):
DATABASE_URL_PRIMARY="postgresql://user:pwd@primary.db.example.com:5432/bisman_prod?sslmode=require"

# Read replica (read-only):
DATABASE_URL_REPLICA="postgresql://user:pwd@replica.db.example.com:5432/bisman_prod?sslmode=require"

# Fall back to primary if replica is unavailable (default: true)
DATABASE_REPLICA_FALLBACK=true

# Connection pool sizes (adjust based on workload)
PRIMARY_CONNECTION_LIMIT=10
REPLICA_CONNECTION_LIMIT=20
PRIMARY_POOL_TIMEOUT=10
REPLICA_POOL_TIMEOUT=10

# Logging options
LOG_QUERIES=false
LOG_DB_ROUTING=false
LOG_HEALTH_CHECKS=false

# ============================================================================
# Usage Metering
# ============================================================================
# Track API calls, storage, and active users per tenant per day

# Enable/disable usage metering (default: true)
USAGE_METER_ENABLED=true

# Batch writes to database for performance
USAGE_METER_BATCH_SIZE=100
USAGE_METER_FLUSH_INTERVAL_MS=5000

# Logging
LOG_USAGE_METER=false

# ============================================================================
# Tenant Quotas & Rate Limiting
# ============================================================================
# Per-tenant rate limits based on plan

# Redis URL for quota counters
# REDIS_URL=redis://localhost:6379

# Free tier limits
QUOTA_FREE_PER_MINUTE=60
QUOTA_FREE_PER_DAY=5000

# Pro tier limits
QUOTA_PRO_PER_MINUTE=300
QUOTA_PRO_PER_DAY=50000

# Enterprise tier limits
QUOTA_ENTERPRISE_PER_MINUTE=1000
QUOTA_ENTERPRISE_PER_DAY=500000

# Admin bypass tokens (comma-separated, for testing/admin)
# QUOTA_BYPASS_TOKENS=token1,token2

# ============================================================================
# Stripe Billing Integration
# ============================================================================
# Required for subscription management and payments

STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key_here
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_signing_secret_here

# Stripe Price IDs for each plan tier
STRIPE_PRICE_ID_FREE=price_free_tier_id
STRIPE_PRICE_ID_PRO=price_pro_monthly_id
STRIPE_PRICE_ID_ENTERPRISE=price_enterprise_monthly_id

# Billing portal return URL
BILLING_PORTAL_RETURN_URL=http://localhost:3001/settings/billing

# ============================================================================
# Scheduled Jobs Configuration
# ============================================================================
# Control background job scheduling

# Master switch for scheduled jobs (default: true)
ENABLE_SCHEDULED_JOBS=true

# Trial expiry job schedule (cron format, default: hourly at minute 0)
TRIAL_EXPIRY_CRON=0 * * * *

# Daily aggregation job schedule (cron format, default: 2:00 AM)
DAILY_AGGREGATION_CRON=0 2 * * *

# Trial grace period in days (tenants can upgrade after expiry)
TRIAL_GRACE_PERIOD_DAYS=7

# Enable job queue worker (default: true)
ENABLE_JOB_WORKER=true

# Job queue polling interval in ms (default: 5000)
JOB_QUEUE_POLL_INTERVAL=5000

# ============================================================================
# Analytics & Telemetry
# ============================================================================
# Event tracking and usage analytics

# Enable event tracking (default: true)
ANALYTICS_ENABLED=true

# Batch size before flushing to database
ANALYTICS_BATCH_SIZE=100

# Flush interval in milliseconds
ANALYTICS_FLUSH_INTERVAL_MS=5000

# Event retention days (for cleanup jobs)
ANALYTICS_RETENTION_DAYS=90

# ============================================================================
# Alerting & Notifications
# ============================================================================
# Configure alert delivery for quota warnings and SLA violations

# Enable alert jobs (quota alerts, weekly audits)
ENABLE_ALERT_JOBS=true

# Ops team email (receives all alerts)
OPS_ALERT_EMAIL=ops@company.com

# SMTP settings for alerts (can reuse main SMTP if not specified)
ALERT_SMTP_HOST=smtp.example.com
ALERT_SMTP_PORT=587
ALERT_SMTP_USER=alerts@company.com
ALERT_SMTP_PASS=secret
ALERT_SMTP_SECURE=false
ALERT_FROM_EMAIL="Alerts <alerts@company.com>"

# Alert thresholds
QUOTA_WARNING_THRESHOLD=80
ERROR_BUDGET_WARNING_THRESHOLD=20

# Cron schedules
QUOTA_ALERT_CRON=30 * * * *
WEEKLY_AUDIT_CRON=0 0 * * 0
